<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description"
        content="Godot Animation Track Loader written by Kyle Orlinski">
    <title>Godot Animation Track Loader - Kyle Orlinski</title>
    <link rel="shortcut icon" type="image/x-icon" href="../../images/little-jimmie-32x32.png">
    <script type="text/javascript" src="../../../dist/main.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8SQ6V0SLTT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-8SQ6V0SLTT');
    </script>

</head>

<body>
    <a href="#">
        <div class="backtotop clickable">
            <div><i class="fas fa-arrow-up"></i></div>Top
        </div>
    </a>

    <nav class="nav-blog">

        <div class="nav-logo-container-blog">
            <a href="/">
                <img class="nav-logo-container__logo" src="../../images/Logo.png" alt="Kyle Orlinski Logo">
            </a>
        </div>

        <div class="hamburgermenu">
            <input type="checkbox" class="hamburgermenu__checkbox" id="navi-toggle">

            <label for="navi-toggle" class="hamburgermenu__button">
                <span class="hamburgermenu__icon">&nbsp;</span>
            </label>

            <div class="hamburgermenu__background">&nbsp;</div>

            <div class="hamburgermenu__nav">
                <ul class="hamburgermenu__list">
                    <li class="hamburgermenu__item"><a href="../../../index.html#about-section"
                            class="hamburgermenu__link">About</a></li>
                    <li class="hamburgermenu__item"><a href="../../../index.html#projects-section"
                            class="hamburgermenu__link">Projects</a></li>
                    <li class="hamburgermenu__item"><a href="../../../index.html#blog-section"
                            class="hamburgermenu__link">Blog</a></li>
                    <li class="hamburgermenu__item"><a href="../../../index.html#contact-section"
                            class="hamburgermenu__link">Contact</a></li>
                </ul>
            </div>

        </div>

        <div class="desktop-navigation-blog">
            <div class="desktop-navigation__card_2up">

            </div>

            <div class="desktop-navigation__card_2up">
                <ul class="desktop-navigation__list">
                    <a class="desktop-navigation__list-item" href="../../../index.html#about-section">
                        <li>
                            About
                        </li>
                    </a>
                    <a class="desktop-navigation__list-item" href="../../../index.html#projects-section">
                        <li>
                            Projects
                        </li>
                    </a>
                    <a class="desktop-navigation__list-item" href="../../../index.html#blog-section">
                        <li>
                            Blog
                        </li>
                    </a>
                    <a class="desktop-navigation__list-item" href="../../../index.html#contact-section">
                        <li>
                            Contact
                        </li>
                    </a>
                </ul>
            </div>
    </nav>
    <main class="article-main">
        <a href="#">
            <div class="backtotop">
                <div><i class="glyphicon glyphicon-menu-up"></i></div>Top
            </div>
        </a>
        <article class="article">
            <section class="article-section">
                <h1 class="article-header">
                    <span class="text-primary">Godot 3.5-4+:</span> Animation Track Loader
                </h1>
                <p>Jan 09 2024</p>
                <h2 class="article-section-header">Setup</h2>
                <p class="article-paragraph">
                    This is my initial player structure that will be referenced in the setup process. The root node Player 
                    has a script attached called Player.gd and the following code will be within this script.
                </p>
                <img src="../../images/godotplayerstructure.png" />
                <p class="article-paragraph">
                    My example is from an FPS game I am building. The example can be interchanged to mold into any game that has 
                    a similar player node structure. Past the example I explain a number of key take-aways and details.
                </p>
                <pre class="code-block">
@onready var animation_player: AnimationPlayer = mesh.get_node("AnimationPlayer")

var path_to_player_node: NodePath = ""

func _ready():
    var animation_player_root_node = animation_player.get_parent()
    
    path_to_player_node = animation_player_root_node.get_path_to(self)

func setup_pistol_track_events():
    const WIELD_PISTOL_FIRE = "Wield_Pistol_Fire"
    const WIELD_PISTOL_RELOAD = "Wield_Pistol_Reload"

    var wield_pistol_fire: Animation = animation_player.get_animation(WIELD_PISTOL_FIRE)
    var wield_pistol_reload: Animation = animation_player.get_animation(WIELD_PISTOL_RELOAD)

    track_builder(wield_pistol_fire, path_to_player_node, wield_pistol_fire.length, track_key_details("ready_to_fire", []))
    track_builder(wield_pistol_reload, path_to_player_node, wield_pistol_reload.length, track_key_details("reload_revolver", []))

func track_key_details(animation_name: String, animation_arguments):
    return { "method": animation_name, "args": animation_arguments, }

func track_builder(animation: Animation, path_to_node: NodePath, timestamp: float, track_details):
    var animation_track = animation.add_track(Animation.TYPE_METHOD)

    animation.track_set_path(animation_track, path_to_node)
    animation.track_insert_key(animation_track, timestamp, track_details)
    
                </pre>
                <p class="article-paragraph">
                    If your method call has parameters you want to pass values into see below.
                </p>
                <pre class="code-block">
function ready_to_fire(is_ready: bool):
    ...

# Usage: track_builder(wield_pistol_fire, path_to_player_node, wield_pistol_fire.length, track_key_details("ready_to_fire", [true]))
                </pre>
                <p class="article-paragraph">
                    Another use case is what happens if you have a method you want to call that is not on the root node? Keep in mind, all that the path_to_node means 
                    is where is the source to the method I wish to append to this track.
                </p>
                <p class="article-paragraph">
                    In a different project I abstracted the track builder methods into their own Script. Here I have two sources where I need to call methods from.
                </p>
<pre class="code-block">
# Example is from Godot 3.5+
var animation_player: AnimationPlayer = null
var player_node: Character = null
var player_mesh_node: Spatial = null

var path_to_player_node: NodePath = ""
var path_to_player_mesh_node: NodePath = ""

# init called from Player.gd or a ready function of a parent node
func init(animationPlayer: AnimationPlayer, playerNode: Character, playerMeshNode: Spatial):
    animation_player = animationPlayer
    player_node = playerNode
    player_mesh_node = playerMeshNode

    set_node_paths()

    one_hander_attack_setup()
    duel_wield_attack_setup()

func set_node_paths():
    var animation_player_root_node = animation_player.get_parent()

    path_to_player_node = animation_player_root_node.get_path_to(player_node)
    path_to_player_mesh_node = animation_player_root_node.get_path_to(player_mesh_node)
</pre>
                <p class="article-paragraph">
                    Usage:
                </p>
                <img src="../../images/godotmethodloaderexpanded.png" />
            </section>
            <section class="article-section">
                <h2 class="article-section-header">Key Takeaways</h2>
                <p class="article-paragraph">
                    The main use case is to bypass the manual approach of adding the method call tracks yourself. This proves to be tedious, especially for rapid animation prototyping. 
                    My animation workflow is done through Blender using Auto Rig Pro as the export process. To manually export the animations yourself on a rig. This <a href="https://www.youtube.com/watch?v=wEJ-ex4_gYc&ab_channel=Whimfoome">video</a> 
                    covers it well.
                </p>
                <p class="article-paragraph">
                    To better understand how to add tracks to an animation player. You can visit the latest documentation for Godot on the topic <a href="https://docs.godotengine.org/en/stable/classes/class_animation.html#class-animation-method-add-track">here</a>. 
                </p>
            </section>
        </article>
    </main>
    <footer class="container-full text-center">
        <p class="paragraph">Â© 2023, Created by <a class="link transition" href="/">Kyle Orlinski</a></p>
        <ul class="list-inline">
            <li class="mx-1 text text-large"><a class="link-black transition" target="_blank" rel="noopener noreferrer"
                    href="https://github.com/Mizuone"><i class="fab fa-github"></i></a></li>
            <li class="mx-1 text text-large"><a class="link-black transition" target="_blank" rel="noopener noreferrer"
                    href="https://www.linkedin.com/in/kyleorlinskideveloper/"><i class="fab fa-linkedin-in"></i></a></li>
        </ul>
    </footer>
</body>

</html>